# SPDX-License-Identifier: AGPL-3.0-only

type: Statement
name: commit
spec:
  syntax: "COMMIT [ TRANSACTION ];"
  summary: "Finalises a transaction, making all data modifications a permanent part of the database."
  variants:
    - name: Default
      summary: "Finalises the current transaction, making all changes permanent."
      syntax: "COMMIT [ TRANSACTION ];"
      examples:
        - query: |
            BEGIN TRANSACTION;

            CREATE account:one SET balance = 135605.16;
            CREATE account:two SET balance = 91031.31;

            UPDATE account:one SET balance += 300.00;
            UPDATE account:two SET balance -= 300.00;

            COMMIT TRANSACTION;
        - setup:
            - "CREATE account:one SET balance = 135605.16;"
            - "CREATE account:two SET balance = 91031.31, wants_to_send_money = true;"
          query: |
            BEGIN;

            IF !account:two.wants_to_send_money {
                THROW "Customer doesn't want to send any money!";
            };

            LET $first = UPDATE ONLY account:one SET balance += 300.00;
            LET $second = UPDATE ONLY account:two SET balance -= 300.00;

            RETURN "Money sent! Status:\n" + <string>$first + '\n' + <string>$second;

            COMMIT;
